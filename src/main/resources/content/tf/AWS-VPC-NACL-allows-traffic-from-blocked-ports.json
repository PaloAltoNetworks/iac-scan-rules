{
  "severity": "medium",
  "resourceType": "AWS VPC NACL allow traffic",
  "policy": "AWS VPC NACL allows traffic from blocked ports",
  "description": "Ensure AWS VPC NACL blocks traffic from blocked ports",
  "rule": "$.resource[*].aws_network_acl exists and $.resource[*].aws_network_acl.*[*].*.ingress[?(@.protocol == 'tcp' && @.from_port == '22' && @.to_port == '22')].action==allow or $.resource[*].aws_network_acl.*[*].*.ingress[?(@.protocol == 'tcp' && @.from_port == '21' && @.to_port == '21')].action==allow or $.resource[*].aws_network_acl.*[*].*.ingress[?(@.protocol == 'tcp' && @.from_port == '5800' && @.to_port == '5800')].action==allow or $.resource[*].aws_network_acl.*[*].*.ingress[?(@.protocol == 'tcp' && @.from_port == '5900' && @.to_port == '5903')].action==allow or  $.resource[*].aws_network_acl.*[*].*.ingress[?(@.protocol == 'tcp' && @.from_port == '2323' && @.to_port == '2323')].action==allow or $.resource[*].aws_network_acl.*[*].*.ingress[?(@.protocol == 'tcp' && @.from_port == '23' && @.to_port == '23')].action==allow or $.resource[*].aws_network_acl.*[*].*.ingress[?(@.protocol == 'tcp' && @.from_port == '25' && @.to_port == '25')].action==allow or $.resource[*].aws_network_acl.*[*].*.ingress[?(@.protocol == 'tcp' && @.from_port == '110' && @.to_port == '110')].action==allow or $.resource[*].aws_network_acl.*[*].*.ingress[?(@.protocol == 'tcp' && @.from_port == '143' && @.to_port == '143')].action==allow or $.resource[*].aws_network_acl.*[*].*.ingress[?(@.protocol == '-1' && @.from_port == '53' && @.to_port == '53')].action==allow or $.resource[*].aws_network_acl.*[*].*.ingress[?(@.protocol == 'udp' && @.from_port == '135' && @.to_port == '135')].action==allow or $.resource[*].aws_network_acl.*[*].*.ingress[?(@.protocol == '-1' && @.from_port == '137' && @.to_port == '139')].action==allow or $.resource[*].aws_network_acl.*[*].*.ingress[?(@.protocol == 'udp' && @.from_port == '69' && @.to_port == '69')].action==allow",
  "id": "1cc0ec13-4079-4e27-b597-9edf83a1cd93",
  "enabled": true,
  "recommendation": {
    "name": "Recommended solution for not allowing traffic from blocked ports in AWS VPC NACL",
    "description": "Ensure that ingress traffic is not allowed from blocked ports in AWS VPC NACL. Please make sure the value for \"cidr_blocks\" is not equal to \"0.0.0.0/0\" or \"::/0\" for any of the blocked ports under ingress block",
    "snippet": "\"aws_network_acl\": [\n        {\n          \"main\": [\n            {\n              \"ingress\": [\n                {\n                  \"action\": \"deny\",\n                  \"cidr_block\": \"0.0.0.0/0\",\n                  \"from_port\": 53,\n                  \"protocol\": \"-1\",\n                  \"rule_no\": 1200,\n                  \"to_port\": 53\n                }\n              ],\n              \"vpc_id\": \"${aws_vpc.demo.id}\"\n            }\n          ]\n        }\n      ]"
  }
}
